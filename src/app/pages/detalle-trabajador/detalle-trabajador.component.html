<div class="detalle-trabajador-container">

  <!-- Sidebar -->
  <div class="sidebar">
    <h3>Panel de Trabajadores</h3>
    <ul class="nav flex-column">
      <li class="nav-item"><button class="btn-sidebar" routerLink="/dashboard">ğŸ  Dashboard</button></li>
      <li class="nav-item"><button class="btn-sidebar" routerLink="/sedes">ğŸ“ Sedes</button></li>
      <li class="nav-item"><button class="btn-sidebar" routerLink="/trabajadores">ğŸ‘· Trabajadores</button></li>
      <li class="nav-item"><button class="btn-sidebar" routerLink="/perfil">ğŸ‘¤ Perfil</button></li>
    </ul>
    <button class="btn-logout" (click)="cerrarSesion()">âŒ Cerrar SesiÃ³n</button>
  </div>

  <!-- Contenido Principal -->
  <div class="main-content">
    <div class="content-container">

      <!-- BotÃ³n de regresar y refrescar -->
     <div class="fila-extremos">
        <button class="btn-morado" (click)="regresar()">â¬… Regresar</button>
        <button class="btn-morado" (click)="refrescarVista()">ğŸ”„ Actualizar PÃ¡gina</button>
      </div>


      <!-- TÃ­tulo con nombre y sede -->
      <h2 class="titulo-nombre">ğŸ‘¤ {{ trabajador.nombre }}</h2>
      <p class="subtitulo-sede">ğŸ¢ {{ obtenerNombreSede(trabajador.sede) }}</p>

      <div class="botones-descarga">
        <button mat-raised-button color="warn" class="btn-descarga" (click)="abrirSelectorDeFechas()">
          ğŸ“„ Generar PDF
        </button>

        <button mat-raised-button color="primary" class="btn-descarga btn-excel" (click)="abrirSelectorDeFechasExcel()">
          ğŸ“Š Generar Excel
        </button>
      </div>

          <p></p>
    <!-- ğŸ“Œ InformaciÃ³n del Trabajador en un panel colapsable -->
    <mat-accordion>
      <mat-expansion-panel [expanded]="false" class="panel-transparente">
        <mat-expansion-panel-header>
          <mat-panel-title>
            ğŸ›  InformaciÃ³n del Trabajador
          </mat-panel-title>
        </mat-expansion-panel-header>

        <mat-card class="seccion-card">
          <mat-card-content>
            <div class="info-trabajador">
              <div class="info-campos">

                <label>Nombre:
                  <input type="text" [(ngModel)]="trabajador.nombre" [disabled]="rolUsuario === 'Revisor' || !modoEdicion">
                </label>

                <label>Correo:
                  <input type="email" [(ngModel)]="trabajador.correo" [disabled]="rolUsuario === 'Revisor' || !modoEdicion">
                </label>

                <label>TelÃ©fono:
                  <input type="text" [(ngModel)]="trabajador.telefono" [disabled]="rolUsuario === 'Revisor' || !modoEdicion">
                </label>

                <label>TelÃ©fono de Emergencia:
                  <input type="text" [(ngModel)]="trabajador.telefonoEmergencia" [disabled]="rolUsuario === 'Revisor' || !modoEdicion">
                </label>

                <label>DirecciÃ³n:
                  <input type="text" [(ngModel)]="trabajador.direccion" [disabled]="rolUsuario === 'Revisor' || !modoEdicion">
                </label>

                <label>Puesto:
                  <input type="text" [(ngModel)]="trabajador.puesto" [disabled]="rolUsuario === 'Revisor' || !modoEdicion">
                </label>

              </div>
              <!-- ğŸ¯ Botones visibles solo si NO es revisor -->
              <div class="botones" *ngIf="rolUsuario !== 'Revisor'">
                <button (click)="activarEdicion()" *ngIf="!modoEdicion" class="editar">
                  <i class="bi bi-pencil-fill"></i> Editar
                </button>
                <button (click)="actualizarTrabajador()" *ngIf="modoEdicion" class="actualizar">
                  <i class="bi bi-save-fill"></i> Actualizar
                </button>
                <button (click)="cancelarEdicion()" *ngIf="modoEdicion" class="cancelar">
                  <i class="bi bi-x-circle-fill"></i> Cancelar
                </button>
              </div>

            </div>
          </mat-card-content>
        </mat-card>
      </mat-expansion-panel>
    </mat-accordion>

    <p></p>
      <!-- ğŸ—“ ConfiguraciÃ³n de Calendario del Trabajador -->
      <mat-accordion>
        <mat-expansion-panel [expanded]="false" class="panel-transparente">
          <mat-expansion-panel-header>
            <mat-panel-title>ğŸ—“ ConfiguraciÃ³n de Calendario del Trabajador</mat-panel-title>
          </mat-expansion-panel-header>

          <mat-card class="seccion-card">
            <mat-card-content>
              <app-calendario-trabajador-visual
              *ngIf="trabajador && trabajador._id"
              [trabajadorId]="trabajador._id"
              [rolUsuario]="rolUsuario"
              (eventosActualizados)="actualizarEventosTrabajadorDesdeVisual($event)">
            </app-calendario-trabajador-visual>
            </mat-card-content>
          </mat-card>
        </mat-expansion-panel>
      </mat-accordion>

      <!-- ğŸ”’ Mensaje para Revisor -->
      <div class="mensaje-revisor" *ngIf="rolUsuario === 'Revisor'">
        ğŸ”’ Solo puedes visualizar los detalles del trabajador.
      </div>

     <!-- ğŸ“… Calendario del Trabajador -->
      <div class="calendario-container">
        <h3>ğŸ“… Calendario del Trabajador</h3>
         <app-calendario-unificado
           *ngIf="trabajador.asistencias"
           [asistencias]="trabajador.asistencias"
           [eventosSede]="eventosSede"
           [eventosTrabajador]="eventosTrabajador">
        </app-calendario-unificado>
      </div>
    </div>
  </div>
</div>
