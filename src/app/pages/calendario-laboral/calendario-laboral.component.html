<div class="admin-dashboard-container">
  <!-- 📌 Botón para abrir el sidebar en móviles -->
  <button class="menu-toggle" (click)="toggleSidebar()">☰</button>

  <!-- 📌 Fondo para cerrar el sidebar en móviles -->
  <div class="sidebar-overlay" (click)="toggleSidebar()"></div>

  <!-- 📌 Sidebar -->
  <div class="sidebar" [class.active]="sidebarAbierto">
    <h3>Configuración de Calendario General</h3>
    <ul class="nav flex-column">
      <li class="nav-item"><button class="btn-sidebar" routerLink="/dashboard">🏠 Dashboard</button></li>
      <li class="nav-item"><button class="btn-sidebar" routerLink="/sedes">📍 Sedes</button></li>
      <li class="nav-item"><button class="btn-sidebar" routerLink="/trabajadores">👷 Trabajadores</button></li>
      <li class="nav-item"><button class="btn-sidebar" routerLink="/perfil">👤 Perfil</button></li>
      <li class="nav-item"><button class="btn-sidebar" routerLink="/acerca-de">ℹ️ Acerca de</button></li>
      <li class="nav-item" *ngIf="esAdmin()"><button class="btn-sidebar" routerLink="/usuarios">🧑‍💼 Ver Usuarios</button></li>
    </ul>
    <button class="btn-logout" (click)="cerrarSesion()">❌ Cerrar Sesión</button>
  </div>

  <!-- 📌 Fondo para cerrar el sidebar en móviles -->
  <div class="sidebar-overlay" [class.active]="sidebarAbierto" (click)="toggleSidebar()"></div>

  <!-- 📌 Contenido principal -->
  <div class="main-content">
    <div class="contenedor-calendario">
      <!-- 📝 Título -->
      <h2 class="mat-title text-center" style="margin-bottom: 20px;">Configuración de Calendario Laboral</h2>
      <p class="text-center" style="margin-bottom: 30px;">Consulta y administra los días especiales por sede</p>

      <!-- 📌 Filtros mejorados con botón -->
      <div class="formulario-busqueda mat-elevation-z2">
        <div class="campos-filtros">
          <mat-form-field appearance="outline" class="campo">
            <mat-label><mat-icon>location_on</mat-icon> Sede</mat-label>
            <mat-select [(value)]="sedeSeleccionada">
              <mat-option *ngFor="let sede of sedes" [value]="sede.id">{{ sede.nombre }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="campo">
            <mat-label><mat-icon>calendar_today</mat-icon> Año</mat-label>
            <input matInput type="number" [(ngModel)]="anioSeleccionado" min="2023" max="2030" />
          </mat-form-field>

          <button mat-flat-button color="primary" class="boton-buscar" (click)="consultarCalendario()">
            <mat-icon>search</mat-icon> Buscar
          </button>
          <p class="text-center" style="margin-bottom: 30px;">Cada vez que busques una nueva sede recuerda volver a seleccionar el boton de "Buscar" en caso contrario no mostrar los datos</p>
        </div>
      </div>

      <!-- 🕊️ Asistente de Domingo -->
      <div class="asistente-card mat-elevation-z2">
        <div class="asistente-row">
          <mat-slide-toggle [(ngModel)]="asistenteDomingoActivo" [disabled]="!esAdmin()">
            🕊️ Asistente de Domingo (marcar domingos como Descanso)
          </mat-slide-toggle>

          <span class="muted" *ngIf="!esAdmin()">Solo Dios/Administrador</span>
          <span class="grow"></span>

          <div class="asistente-actions">
            <button mat-stroked-button color="primary"
                    (click)="simularAsistenteDomingo()"
                    [disabled]="!asistenteDomingoActivo || !esAdmin()">
              👀 Vista previa
            </button>

            <button mat-flat-button color="accent"
                    (click)="aplicarAsistenteDomingo()"
                    [disabled]="!asistenteDomingoActivo || !esAdmin() || !previewAsistente || previewAsistente.aCrear === 0">
              ✅ Aplicar
            </button>
          </div>
        </div>

        <div class="asistente-grid">
          <mat-form-field appearance="outline">
            <mat-label>Inicio</mat-label>
            <input matInput type="date" [(ngModel)]="rangoDomingoInicio" (change)="limpiarPreviewAsistente()">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Fin</mat-label>
            <input matInput type="date" [(ngModel)]="rangoDomingoFin" (change)="limpiarPreviewAsistente()">
          </mat-form-field>
        </div>

        <p class="asistente-tip">
          ⚠️ Advertencia: Para no saturar el servidor, configura rangos cortos (ej. 1–2 meses) si aplicas a varias sedes.
        </p>

        <mat-checkbox class="asistente-mas-sedes"
                      [(ngModel)]="aplicarDomingoMasSedes"
                      (change)="onToggleAplicarDomingoMasSedes()"
                      [disabled]="!asistenteDomingoActivo || !esAdmin()">
          ¿Aplicar a más sedes?
        </mat-checkbox>

        <div *ngIf="aplicarDomingoMasSedes && sedesExtrasAsistente?.length" class="asistente-sedes-grid">
          <mat-checkbox *ngFor="let s of sedesExtrasAsistente"
                        [(ngModel)]="s.seleccionada"
                        [disabled]="!asistenteDomingoActivo || !esAdmin()">
            {{ s.nombre }}
          </mat-checkbox>
        </div>

        <div *ngIf="previewAsistente" class="asistente-preview">
          <b>Vista previa:</b>
          <div>• Domingos en rango: {{ previewAsistente.totalDomingos }}</div>
          <div>• A crear (Descanso): <b>{{ previewAsistente.aCrear }}</b></div>
          <div>• Ya ocupados (no se tocan): {{ previewAsistente.conEvento }}</div>
          <div>• Sedes procesadas: {{ previewAsistente.sedesProcesadas }}</div>
        </div>
      </div>

      <!-- 📆 Calendario visual -->
      <app-calendario-sede
        *ngIf="busquedaRealizada && sedeSeleccionada !== null && sedes.length"
        [sede]="sedeSeleccionada!"
        [sedeNombre]="sedeSeleccionadaNombre"
        [anio]="anioSeleccionado"
        [eventos]="diasEspeciales"
        [todasLasSedes]="sedes"
        (eventoGuardado)="onEventoGuardado($event)"
        (eventoEliminado)="onEventoEliminado($event)">
      </app-calendario-sede>

      <!-- 💬 Mensaje si no hay configuración -->
      <div *ngIf="busquedaRealizada && diasEspeciales.length === 0" class="mensaje-vacio">
        <p>No hay configuración de calendario para esta sede y año.</p>
      </div>
    </div>
  </div>
</div>
